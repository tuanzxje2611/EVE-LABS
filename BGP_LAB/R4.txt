en
conf t
hostname R4
line console 0
exec-timeout 0 0
no ip domain lookup

int loopback 0
ip address 4.4.4.4 255.255.255.255
int e0/0
ip address 192.168.14.4 255.255.255.0
no shutdown
int e0/1
ip address 192.168.24.4 255.255.255.0
no shutdown
int e0/2
ip address 192.168.45.4 255.255.255.0
no shutdown
int e0/3
ip address 192.168.46.4 255.255.255.0
no shutdown

!********* OSPF *******
router ospf 1
 network 4.4.4.4 0.0.0.0 area 0
 network 192.168.46.0 0.0.0.255 area 0
 network 192.168.45.0 0.0.0.255 area 0


!********* BGP *******
router bgp 45
 bgp confederation identifier 4567 		<--- to identify that this is sub-as of 4567
 bgp confederation peer 67			<--- it hold the same hierarchy with sub-as 67
 neighbor 5.5.5.5 remote-as 45 			
 neighbor 5.5.5.5 update-source Loopback0
 neighbor 6.6.6.6 remote-as 67
 neighbor 6.6.6.6 update-source Loopback0 
 neighbor 6.6.6.6 ebgp-multihop 2		<--- it's needed to set the multihop for eBGP, if not it will 								drop the frame because of out TTL	


!********* eBGP *******
router bgp 45
 neighbor 192.168.14.1 remote-as 1
 neighbor 192.168.24.2 remote-as 23
 

!********* advertise the IPv4 addresses of the loopback interfaces *******
router bgp 45
network 4.4.4.4 mask 255.255.255.255


!********* Next-hop-self for AS4567 *******
router bgp 45
 neighbor 5.5.5.5 next-hop-self
 neighbor 6.6.6.6 next-hop-self


!********* BGP Weight Attribute: 12.34.0.0/16 be routed from R4 via AS 23 *******

ip prefix-list 12_34_via_R2 permit 12.34.0.0/16

route-map SETWEIGHT permit 10
 match ip address prefix-list 12_34_via_R2
 set weight 500
route-map SETWEIGHT permit 20

router bgp 45
 neighbor 192.168.24.2 route-map SETWEIGHT in

clear ip bgp * soft in           <--- use to clear bgp process



!********* AS Path Prepending: traffic from R1 to Loopback0(R9) prefer via AS23 *******
ip prefix-list R1_to_R9loopback0 permit 9.9.9.9/32

route-map SETasprepend permit 10
 match ip address prefix-list  R1_to_R9loopback0
 set as-path prepend 4567 4567 4567

route-map permit 20
router bgp 45 
 neighbor 192.168.14.1 route-map SETasprepend out



